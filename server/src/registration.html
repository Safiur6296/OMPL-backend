<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OMPL Registration</title>
    <link rel="stylesheet" href="css/registration.css">

</head>

<body>
    <div class="container">
        <form netlify action="#" method="post" enctype="multipart/form-data">
            <div class="form-header">
                <h1>OLD MALDA PREMIER LEAGUE</h1>
                <p>Player Registration Form</p>
            </div>

            <div class="form-section">
                <div class="input-group">
                    <label for="playerName">Player Name*</label>
                    <input type="text" id="playerName" name="playerName" required>
                </div>

                <div class="input-group">
                    <label for="playerAge">Player Age*</label>
                    <input type="number" id="playerAge" name="playerAge" required>
                </div>

                <div class="input-group">
                    <label for="playerPhoto">Upload Player Photo*</label>
                    <input type="file" id="playerPhoto" name="playerPhoto" accept="image/*" required>
                </div>

                <div class="input-group">
                    <label for="address">Address*</label>
                    <textarea id="address" name="address" required></textarea>
                </div>

                <div class="input-group">
                    <label for="phoneNumber">Phone Number*</label>
                    <input type="tel" id="phoneNumber" name="phoneNumber" required>
                </div>

                <div class="input-group">
                    <label for="aadharCard">Upload Aadhar Card*</label>
                    <input type="file" id="aadharCard" name="aadharCard" accept="application/pdf,image/*" required>
                </div>

                <div class="radio-group">
                    <label class="radio-label">Player Category*</label>
                    <div class="radio-options">
                        <label class="radio-item">
                            <input type="radio" name="playerCategory" value="BATSMAN" required>
                            <span>BATSMAN</span>
                        </label>
                        <label class="radio-item">
                            <input type="radio" name="playerCategory" value="BOWLER">
                            <span>BOWLER</span>
                        </label>
                        <label class="radio-item">
                            <input type="radio" name="playerCategory" value="ALL ROUNDER">
                            <span>ALL ROUNDER</span>
                        </label>
                    </div>
                </div>

                <div class="radio-group">
                    <label class="radio-label">Player Type*</label>
                    <div class="radio-options">
                        <label class="radio-item">
                            <input type="radio" name="playerType" value="LEFTY" required>
                            <span>LEFTY</span>
                        </label>
                        <label class="radio-item">
                            <input type="radio" name="playerType" value="RIGHTY">
                            <span>RIGHTY</span>
                        </label>
                    </div>
                </div>
            </div>
            <!-- Add this before the form-footer div -->
            <div class="radio-group">
                <label class="radio-label">Upper Jersey Size*</label>
                <div class="radio-options">
                    <label class="radio-item">
                        <input type="radio" name="upperJerseySize" value="S" required>
                        <span>S</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="upperJerseySize" value="M">
                        <span>M</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="upperJerseySize" value="L">
                        <span>L</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="upperJerseySize" value="XL">
                        <span>XL</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="upperJerseySize" value="XXL">
                        <span>XXL</span>
                    </label>
                </div>
            </div>

            <div class="radio-group">
                <label class="radio-label">Lower Jersey Size*</label>
                <div class="radio-options">
                    <label class="radio-item">
                        <input type="radio" name="lowerJerseySize" value="28" required>
                        <span>28</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="lowerJerseySize" value="30">
                        <span>30</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="lowerJerseySize" value="32">
                        <span>32</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="lowerJerseySize" value="34">
                        <span>34</span>
                    </label>
                </div>
            </div>

            <div class="form-footer">
                <button type="submit">Pay â‚¹299</button>
                <a href="index.html" class="home-btn">Back to Home</a>
            </div>
        </form>
        <div id="loadingScreen" class="loading-screen" style="display: none;">
            <div class="loader"></div>
            <h2>Payment Successful!</h2>
            <p>Please wait while we process your registration...</p>
        </div>
        <div id="successMessage" class="success-message" style="display: none;">
            <h2>Registration Successful!</h2>
            <p>You can get your card from Official OMPL Whatsapp Group</p>
            <p>Thank you for Registration</p>
        </div>
    </div>

    <script>
        function validateFiles() {
            const maxSize = 5 * 1024 * 1024;
            const photo = document.getElementById('playerPhoto').files[0];
            const aadhar = document.getElementById('aadharCard').files[0];

            if (!photo || !aadhar) {
                alert('Please upload all required files');
                return false;
            }

            if (photo.size > maxSize || aadhar.size > maxSize) {
                alert('File size should not exceed 5MB');
                return false;
            }

            const allowedTypes = ['image/jpeg', 'image/png', 'image/jpg', 'application/pdf'];
            if (!allowedTypes.includes(photo.type) || !allowedTypes.includes(aadhar.type)) {
                alert('Please upload valid file types (JPG, PNG, PDF)');
                return false;
            }

            return true;
        }

        function validateForm() {
            const requiredFields = ['playerName', 'playerAge', 'address', 'phoneNumber'];
            for (const fieldId of requiredFields) {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    alert(`Please fill in ${fieldId}`);
                    return false;
                }
            }

            const radioGroups = ['playerCategory', 'playerType', 'upperJerseySize', 'lowerJerseySize'];
            for (const groupName of radioGroups) {
                if (!document.querySelector(`input[name="${groupName}"]:checked`)) {
                    alert(`Please select ${groupName}`);
                    return false;
                }
            }

            return validateFiles();
        }

        async function convertFileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        document.querySelector('form').addEventListener('submit', async function(e) {
            e.preventDefault();

            if (!validateForm()) return;

            const button = this.querySelector('button[type="submit"]');
            button.disabled = true;
            button.textContent = 'Processing...';

            try {
                const formData = new FormData(this);
                const formObject = {};
                
                // Convert files to base64
                const photo = document.getElementById('playerPhoto').files[0];
                const aadhar = document.getElementById('aadharCard').files[0];
                
                const photoBase64 = await convertFileToBase64(photo);
                const aadharBase64 = await convertFileToBase64(aadhar);

                formData.forEach((value, key) => {
                    if (!(value instanceof File)) {
                        formObject[key] = value;
                    }
                });

                formObject.playerPhoto = photoBase64;
                formObject.playerPhotoName = photo.name;
                formObject.aadharCard = aadharBase64;
                formObject.aadharCardName = aadhar.name;
                formObject.paymentStatus = 'Pending';

                localStorage.setItem('registrationData', JSON.stringify(formObject));

                // Create form data for submission
                const submitFormData = new FormData();
                
                // Add all form fields
                Object.keys(formObject).forEach(key => {
                    submitFormData.append(key, formObject[key]);
                });

                // Send as form data, not JSON
                const response = await fetch('https://script.google.com/macros/s/AKfycbzvQN3ku28-5lpg0kXZv7mfFrosUMHt1hiMv8FuHRMFNFn4obBESHUixOyWCkAN4oo3PA/exec', {
                    method: 'POST',
                    body: submitFormData
                });

                const result = await response.json();
                
                if (!result || result.result !== 'success') {
                    throw new Error('Failed to save registration data');
                }

                // Store the row number for later update
                if (result.row) {
                    localStorage.setItem('registrationRow', result.row);
                }

                // Redirect to payment
               // window.location.href = 'https://razorpay.me/@mdjamilsekh?amount=kXxURMaXFk%2Bmrv%2B9uGrYpg%3D%3D';
                window.location.href = 'https://razorpay.me/@mdjamilsekh?amount=EPec5evqGoRk2C8icWNJlQ%3D%3D';


            } catch (error) {
                console.error('Error:', error);
                alert('Registration failed. Please try again.');
                button.disabled = false;
                button.textContent = 'Pay â‚¹299';
            }
        });
        
    </script>
</body>

</html>